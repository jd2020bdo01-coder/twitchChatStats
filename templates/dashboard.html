<!-- ...existing code... -->
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Chat Analytics Dashboard</title>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
		<link
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
			rel="stylesheet"
		/>
		<link
			rel="stylesheet"
			href="{{ url_for('static', filename='dashboard.css') }}"
		/>
	</head>
	<body>
		<div class="app-layout">
			<!-- Sidebar Toggle Button -->
			<button
				class="sidebar-toggle expanded"
				id="sidebarToggle"
				onclick="toggleSidebar()"
				aria-label="Toggle sidebar"
			>
				<i class="fas fa-bars" aria-hidden="true"></i>
				<span class="sr-only">Toggle sidebar</span>
			</button>
			<!-- Sidebar -->
			<div class="sidebar" id="sidebar">
				<div class="sidebar-header">
					<div class="sidebar-title">
						<i class="fas fa-filter"></i>
						Filters & Controls
					</div>
				</div>
				<div class="sidebar-content">
					<div class="controls-panel">
						<div class="controls-grid">
							<div class="form-group control-group">
								<label for="channelSelect">Select Channel</label>
								<select
									id="channelSelect"
									class="modern-select"
									onchange="onChannelChange()"
								>
									<option value="">ðŸ“º Choose a channel...</option>
								</select>
							</div>
							<div class="form-group">
								<label for="filterModeSelect">Filter Mode</label>
								<select
									id="filterModeSelect"
									class="modern-select"
									onchange="onFilterModeChange()"
								>
									<option value="range">Date Range</option>
									<option value="include">Select Specific Dates</option>
									<option value="exclude">Exclude Specific Dates</option>
								</select>
							</div>
							<div class="form-group" id="dateFilterGroup">
								<label for="dateFilterInput" id="dateFilterLabel"
									>Date Filter</label
								>
								<div class="date-picker-container">
									<input
										type="text"
										id="dateFilterInput"
										class="modern-input"
										placeholder="Select date or range..."
										onfocus="showDateSuggestions()"
										onblur="hideDateSuggestions()"
										oninput="filterDateSuggestions()"
									/>
									<div id="dateSuggestions" class="date-suggestions"></div>
								</div>
								<div
									id="selectedDatesContainer"
									class="selected-dates-container"
									style="display: none"
								>
									<div class="selected-dates-header">
										<span id="selectedDatesLabel">Selected Dates:</span>
										<button
											type="button"
											class="clear-dates-btn"
											onclick="clearSelectedDates()"
										>
											<i class="fas fa-times"></i> Clear All
										</button>
									</div>
									<div id="selectedDatesList" class="selected-dates-list"></div>
								</div>
							</div>
							<div class="form-group">
								<label>&nbsp;</label>
								<button class="modern-button" onclick="applyFilters()">
									<i class="fas fa-search"></i> Apply Filters
								</button>
							</div>
							<div class="form-group">
								<label>&nbsp;</label>
								<button
									class="modern-button secondary"
									onclick="clearFilters()"
								>
									<i class="fas fa-times"></i> Clear All
								</button>
							</div>
						</div>
					</div>
				</div>
				<div id="channelsOverview" class="channels-grid">
					<!-- Channel cards will be populated here -->
				</div>
			</div>
			<!-- Main Content -->
			<div class="main-content" id="mainContent">
				<div class="status_header">
					<div id="lastUpdate">Last updated: Never</div>
					<div class="connection-status-bar">
						<div id="connectionStatus" class="status-dot disconnected"></div>
						<span id="connectionText" class="status-text">Disconnected</span>
					</div>
				</div>

				<div
					id="selectedChannelInfo"
					class="main-channel-info"
					style="display: none"
				>
					<div class="channel-info-header">
						<h3 id="selectedChannelTitle">Channel Details</h3>
						<div class="channel-badges">
							<span id="channelStatusBadge" class="status-badge"
								>âœ… Up to date</span
							>
						</div>
					</div>
					<div class="channel-stats-grid">
						<div class="stat-card">
							<div class="stat-icon"><i class="fas fa-users"></i></div>
							<div class="stat-content">
								<div class="stat-value" id="channelUserCount">-</div>
								<div class="stat-label">Total Users</div>
							</div>
						</div>
						<div class="stat-card">
							<div class="stat-icon"><i class="fas fa-comments"></i></div>
							<div class="stat-content">
								<div class="stat-value" id="channelMessageCount">-</div>
								<div class="stat-label">Messages</div>
							</div>
						</div>
						<div class="stat-card">
							<div class="stat-icon"><i class="fas fa-calendar"></i></div>
							<div class="stat-content">
								<div class="stat-value" id="channelDateRange">-</div>
								<div class="stat-label">Date Range</div>
							</div>
						</div>
					</div>
				</div>
				<div id="dataTableSection" class="data-section" style="display: none">
					<div class="section-header">
						<div class="section-title">
							<h2 id="sectionTitle">User Analytics</h2>
							<div class="search-container">
								<i class="fas fa-search"></i>
								<input
									type="text"
									id="searchInput"
									class="modern-input"
									placeholder="Search users..."
									oninput="filterTable()"
								/>
							</div>
							<select
								id="sortSelect"
								class="modern-select"
								onchange="sortTable()"
							>
								<option value="chat_count">Sort by Messages</option>
								<option value="username">Sort by Username</option>
								<option value="alt_likelihood">Sort by Alt Score</option>
							</select>
						</div>
						<div class="table-controls">
							<div
								id="channelSummary"
								class="summary-cards"
								style="display: none"
							>
								<!-- Summary cards will be populated here -->
							</div>
						</div>
					</div>
					<div class="table-container">
						<div id="loadingSpinner" class="loading-state">
							<div class="spinner"></div>
							<p>Loading analytics data...</p>
						</div>
						<table id="dataTable" class="modern-table" style="display: none">
							<thead>
								<tr>
									<th onclick="sortByColumn('username')">
										<i class="fas fa-user"></i> Username
									</th>
									<th onclick="sortByColumn('chat_count')">
										<i class="fas fa-comments"></i> Messages
									</th>
									<th onclick="sortByColumn('alt_likelihood')">
										<i class="fas fa-shield-alt"></i> Alt Score
									</th>
									<th><i class="fas fa-chart-line"></i> Last Active</th>
								</tr>
							</thead>
							<tbody id="tableBody">
								<!-- Table rows will be populated here -->
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>

		<!-- User Detail Popup -->
		<div id="userDetailOverlay" class="user-detail-overlay">
			<div class="user-detail-popup">
				<div class="user-detail-header">
					<div class="user-detail-title">
						<div class="user-avatar" id="userAvatar"></div>
						<div>
							<h2 id="userDetailName">Username</h2>
							<p id="userDetailSubtitle" style="opacity: 0.8; margin: 0"></p>
						</div>
					</div>
					<button
						class="user-detail-close"
						onclick="closeUserDetail()"
						aria-label="Close user details"
					>
						<i class="fas fa-times"></i>
					</button>
				</div>
				<div class="user-detail-content">
					<div class="user-detail-tabs">
						<button
							class="user-detail-tab active"
							onclick="switchUserTab('overview')"
						>
							<i class="fas fa-chart-bar"></i> Overview
						</button>
						<button class="user-detail-tab" onclick="switchUserTab('messages')">
							<i class="fas fa-comments"></i> Messages
						</button>
						<button class="user-detail-tab" onclick="switchUserTab('channels')">
							<i class="fas fa-hashtag"></i> Channels
						</button>
						<button class="user-detail-tab" onclick="switchUserTab('analysis')">
							<i class="fas fa-analytics"></i> Analysis
						</button>
						<button class="user-detail-tab" onclick="switchUserTab('activity')">
							<i class="fas fa-calendar-alt"></i> Activity
						</button>
					</div>

					<!-- Overview Tab -->
					<div id="overviewTab" class="user-detail-tab-content active">
						<div class="user-stats-grid" id="userStatsGrid">
							<!-- Stats will be populated here -->
						</div>
						<div>
							<h4 style="margin-bottom: 1rem; color: var(--text-primary)">
								<i class="fas fa-users"></i> Similar Users
							</h4>
							<div id="userSimilarUsers" style="color: var(--text-secondary)">
								<!-- Similar users will be populated here -->
							</div>
						</div>
					</div>

					<!-- Messages Tab -->
					<div id="messagesTab" class="user-detail-tab-content">
						<div
							style="
								margin-bottom: 1rem;
								display: flex;
								gap: 1rem;
								align-items: center;
							"
						>
							<label style="color: var(--text-secondary)"
								>Filter messages:</label
							>
							<input
								type="text"
								id="messageSearch"
								placeholder="Search messages..."
								class="modern-input"
								style="flex: 1"
								oninput="filterUserMessages()"
							/>
							<button
								class="modern-button secondary"
								onclick="clearMessageFilter()"
							>
								<i class="fas fa-times"></i> Clear
							</button>
						</div>
						<div id="userMessagesContainer">
							<div class="user-messages-list" id="userMessagesList">
								<!-- Messages will be populated here -->
							</div>
							<div class="pagination-controls" id="messagesPagination">
								<!-- Pagination will be populated here -->
							</div>
						</div>
					</div>

					<!-- Channels Tab -->
					<div id="channelsTab" class="user-detail-tab-content">
						<div class="user-channels-list" id="userChannelsList">
							<!-- Channels will be populated here -->
						</div>
					</div>

					<!-- Analysis Tab -->
					<div id="analysisTab" class="user-detail-tab-content">
						<div style="display: grid; gap: 2rem">
							<!-- Temporal Analysis Section -->
							<div>
								<h4
									style="
										margin-bottom: 1rem;
										color: var(--text-primary);
										display: flex;
										align-items: center;
										gap: 0.5rem;
									"
								>
									<i class="fas fa-clock"></i> Temporal Analysis
								</h4>
								<div class="analysis-grid" id="temporalAnalysisGrid">
									<!-- Temporal stats will be populated here -->
								</div>
							</div>

							<!-- Chat Frequency Patterns -->
							<div>
								<h4
									style="
										margin-bottom: 1rem;
										color: var(--text-primary);
										display: flex;
										align-items: center;
										gap: 0.5rem;
									"
								>
									<i class="fas fa-chart-line"></i> Chat Frequency Patterns
								</h4>
								<div class="analysis-chart-container">
									<canvas
										id="hourlyActivityChart"
										width="400"
										height="200"
									></canvas>
								</div>
							</div>

							<!-- Behavioral Insights -->
							<div>
								<h4
									style="
										margin-bottom: 1rem;
										color: var(--text-primary);
										display: flex;
										align-items: center;
										gap: 0.5rem;
									"
								>
									<i class="fas fa-brain"></i> Behavioral Insights
								</h4>
								<div class="behavioral-insights" id="behavioralInsights">
									<!-- Behavioral analysis will be populated here -->
								</div>
							</div>

							<!-- Similar Users (moved from table) -->
							<div>
								<h4
									style="
										margin-bottom: 1rem;
										color: var(--text-primary);
										display: flex;
										align-items: center;
										gap: 0.5rem;
									"
								>
									<i class="fas fa-users"></i> Similar Users
								</h4>
								<div id="detailedSimilarUsers" class="similar-users-detailed">
									<!-- Detailed similar users will be populated here -->
								</div>
							</div>
						</div>
					</div>

					<!-- Activity Tab -->
					<div id="activityTab" class="user-detail-tab-content">
						<div class="user-activity-timeline" id="userActivityTimeline">
							<!-- Activity timeline will be populated here -->
						</div>
					</div>
				</div>
			</div>
		</div>

		<script src="{{ url_for('static', filename='dashboard.js') }}"></script>
	</body>
</html>
